// -------------------------------------
// WARNING
// THIS FILE IS AUTOGENERATED BY PRISMERGE
// DO NOT MANUALLY EDIT THIS FILE!
// -------------------------------------

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AccountType {
  ADMIN
  GENERAL_USER
}

model Account {
  id           Int          @id @default(autoincrement())
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  deletedAt    DateTime?
  type         AccountType
  users        User[]
  admin        Admin?
  general_user GeneralUser?

  @@index([type])
}

model Admin {
  accountId Int       @id
  account   Account   @relation(fields: [accountId], references: [id], onDelete: Cascade)
  lastName  String
  firstName String
  email     String
  phone     String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model GeneralUser {
  accountId    Int          @id
  account      Account      @relation(fields: [accountId], references: [id], onDelete: Cascade)
  telegramId   BigInt       @unique
  firstName    String?
  lastName     String?
  username     String?      @unique
  photoUrl     String?
  points       Int          @default(0)
  level        Int          @default(1)
  referralCode String?      @unique @default(cuid())
  referredById Int?
  referrer     GeneralUser? @relation("UserReferrals", fields: [referredById], references: [accountId])

  referredUsers GeneralUser[] @relation("UserReferrals")

  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  deletedAt          DateTime?
  UserAnswer         UserAnswer[]
  UserCourseProgress UserCourseProgress?
  UserTopicProgress  UserTopicProgress[]
  Task               Task[]
}

model User {
  id              Int       @id @default(autoincrement())
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  deletedAt       DateTime?
  email           String    @unique
  firstName       String
  lastName        String?
  password        String
  phone           String?
  isFirstLogin    Boolean?  @default(false)
  lastLogin       DateTime  @default(now())
  hashedRt        String?
  isActivated     Boolean?  @default(false)
  isTermsAccepted Boolean?  @default(false)
  accounts        Account[]

  @@index([email, firstName, lastName])
}

model Answer {
  text       String
  isCorrect  Boolean      @default(false)
  questionId Int
  question   Question     @relation(fields: [questionId], references: [id])
  id         Int          @id @default(autoincrement())
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  deletedAt  DateTime?
  UserAnswer UserAnswer[]
}

model ContentSlide {
  title     String
  body      String
  images    Json?
  topicId   Int
  topic     Topic     @relation(fields: [topicId], references: [id])
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model Category {
  name      String    @unique
  courses   Course[]
  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model Question {
  text       String
  topicId    Int
  points     Int          @default(5)
  topic      Topic        @relation(fields: [topicId], references: [id])
  answers    Answer[]
  id         Int          @id @default(autoincrement())
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  deletedAt  DateTime?
  UserAnswer UserAnswer[]
}

model Topic {
  title             String
  courseId          Int
  course            Course              @relation(fields: [courseId], references: [id])
  contents          ContentSlide[]
  questions         Question[]
  points            Int                 @default(0)
  id                Int                 @id @default(autoincrement())
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  deletedAt         DateTime?
  UserTopicProgress UserTopicProgress[]
}

model Course {
  title              String
  description        String?
  image              String?
  categoryId         Int
  category           Category             @relation(fields: [categoryId], references: [id])
  topics             Topic[]
  points             Int                  @default(0)
  id                 Int                  @id @default(autoincrement())
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  deletedAt          DateTime?
  UserCourseProgress UserCourseProgress[]
}

model UserAnswer {
  userId     Int
  questionId Int
  answerId   Int
  isCorrect  Boolean
  answeredAt DateTime @default(now())

  user      GeneralUser @relation(fields: [userId], references: [accountId])
  question  Question    @relation(fields: [questionId], references: [id])
  answer    Answer      @relation(fields: [answerId], references: [id])
  id        Int         @id @default(autoincrement())
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  deletedAt DateTime?
}

model UserCourseProgress {
  userId      Int
  courseId    Int
  completed   Boolean     @default(false)
  completedAt DateTime?
  user        GeneralUser @relation(fields: [userId], references: [accountId])
  course      Course      @relation(fields: [courseId], references: [id])
  id          Int         @id @default(autoincrement())
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  deletedAt   DateTime?

  @@unique([userId])
}

model UserTopicProgress {
  userId      Int
  topicId     Int
  completed   Boolean
  completedAt DateTime?
  user        GeneralUser @relation(fields: [userId], references: [accountId])
  topic       Topic       @relation(fields: [topicId], references: [id])
  id          Int         @id @default(autoincrement())
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  deletedAt   DateTime?

  @@unique([userId, topicId])
}

model StreakInfo {
  userId        Int       @unique
  currentStreak Int       @default(0)
  longestStreak Int       @default(0)
  lastLoginDate DateTime?

  @@map("streak_infos")
}

model Task {
  userId      Int
  user        GeneralUser @relation(fields: [userId], references: [accountId])
  taskId      String
  taskType    String
  completed   Boolean     @default(false)
  completedAt DateTime?
  expiresAt   DateTime?
  id          Int         @id @default(autoincrement())
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  deletedAt   DateTime?

  @@index([userId, taskId])
}

enum Status {
  ACTIVE
  DELETED
}

model Chat {
  chatId   String? @unique
  chatType String?
  title    String?
  username String?
  status   Status  @default(ACTIVE)

  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model PollVotes {
  telegramId String
  username   String?
  firstName  String?
  lastName   String?
  chatId     String
  pollId     String
  optionId   Int
  points     Int     @default(100)

  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model QuizWinners {
  telegramId String
  username   String?
  firstName  String?
  lastName   String?
  chatId     String?
  pollId     String?
  points     Int     @default(20)
  isClaimed  Boolean @default(false)

  id        Int       @id @default(autoincrement())
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model ScheduledQuiz {
  chatId             String
  question           String
  options            String
  correctOptionIndex Int
  scheduledTime      DateTime
  status             String    @default("pending")
  id                 Int       @id @default(autoincrement())
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  deletedAt          DateTime?
}

model WaitlistUser {
  email            String    @unique
  telegramUsername String?
  ref              String?
  id               Int       @id @default(autoincrement())
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  deletedAt        DateTime?
}
